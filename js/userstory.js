Array.prototype.getUnique=function(){var f={},c,d;for(c=0;d=this[c];c++){f[d]=1}var b=new Array();for(d in f){b.push(d)}return b};String.prototype.len=function(){return this.replace(/[^\x00-\xff]/g,"**").length};var goto_top_type=-1,goto_top_itv=0;function goto_top_timer(){var a=25,b=goto_top_type==1?document.documentElement.scrollTop:document.body.scrollTop;b-=Math.ceil(b*a/100);if(b<0){b=0}if(goto_top_type==1){document.documentElement.scrollTop=b}else{document.body.scrollTop=b}if(b==0){clearInterval(goto_top_itv);goto_top_itv=0}}function goto_top(){if(goto_top_itv==0){if(document.documentElement&&document.documentElement.scrollTop){goto_top_type=1}else{if(document.body&&document.body.scrollTop){goto_top_type=2}else{goto_top_type=0}}if(goto_top_type>0){goto_top_itv=setInterval("goto_top_timer()",20)}}}function show_login(){var d=$(window).height(),b=$(window).width(),c=$(document).scrollTop(),e=$(document).scrollLeft(),a=$(".boxes #dialog");a.css("top",d/2-a.height()/2+c-100);a.css("left",b/2-a.width()/2+e);a.fadeIn(1000)}$(function(){$("body").prepend("<div id='mask'></div>");var a=$("#go_top");a.hide();$(window).bind("scroll",function(){var b=$(document).scrollTop();(b>0)?a.show():a.hide()});$(".follow").click(function(){var b=$(this).attr("id"),f=b.split("_"),d=f[2],g=$(this).text();if("关注"==g){g="follow"}else{g="unfollow"}var e={operation:g,uid:d},c="";$.post("/member/useroperation.php",e,function(h,i){if("success"==i){if(g=="follow"){c=$(".account_count .fans_count").text();$(".account_count .fans_count").text(parseInt(c)+1)}else{c=$(".account_count .fans_count").text();$(".account_count .fans_count").text(parseInt(c)-1)}$(".follow").toggle()}})}).hover(function(){if($(this).text()=="已关注"){$(this).text("取消关注")}},function(){if($(this).text()=="取消关注"){$(this).text("已关注")}});$(".follow_btn").click(function(i){i.preventDefault();var h=$(i.target);if(h.hasClass("need_login")){show_login()}else{var b=$(this).attr("id"),g=b.split("_"),d=g[2],j=$(this).text();if("关注"==j){j="follow"}else{j="unfollow"}var f={operation:j,uid:d},c="";$.post("/member/useroperation.php",f,function(k,l){if("success"==l){if(j=="follow"){c=$(".usersfollowers .count").text();$(".usersfollowers .count").text(parseInt(c)+1);$(".follower_list").append(k)}else{var e=g[0];$("#follower_id_"+e).remove();c=$(".usersfollowers .count").text();$(".usersfollowers .count").text(parseInt(c)-1)}$(".follow_btn").toggle()}console.log(k)})}}).hover(function(){if($(this).text()=="已关注"){$(this).text("取消关注")}},function(){if($(this).text()=="取消关注"){$(this).text("已关注")}});$("#publish_container .load_more").live("click",function(c){c.preventDefault();var k="",h=$(this).attr("id"),j=h.split("_"),f=j[2],d=j[0],i=d-1,g={post_id:f,first_item:d},b=$("<img src='/img/loading.gif' />");$.ajax({type:"POST",url:"/member/loadstoryitem.php",data:g,beforeSend:function(){$("#publish_container .load_more").html(b)},success:function(e){$("#more").remove();$("#weibo_ul").append(e);$("#weibo_ul li:gt("+i+")").each(function(){if($(this).hasClass("sina")){k=$(this).attr("id");WB2.anyWhere(function(l){l.widget.hoverCard({id:k,search:true})})}})}})});WB2.anyWhere(function(b){b.widget.hoverCard({id:"weibo_card_area",search:true})});$("#weibo_ul li.sina").each(function(){var b=$(this).attr("id");WB2.anyWhere(function(c){c.widget.hoverCard({id:b,search:true})})});$("a[name=modal]").live("click",function(k){k.preventDefault();$(".publish-tweet").val("");$("#weibo_dialog .word_counter").text("140");if($(this).hasClass("sina")){$(".boxes #weibo_dialog #icon_flag").removeClass().addClass("sina16_icon");if($(".boxes #weibo_dialog").hasClass("sina")){$("#pub_wrapper").show();$(".pub_imply_sina, .pub_imply_tencent").hide();if($(this).hasClass("repost_f")){$("#pub_text").text("转发").removeClass().addClass("sina");$("#publish_title").text("转发微博");if($(this).hasClass("is_repost")){var m=$(this).closest("li");var h=("//@"+m.find(".weibo_from_drop").text()+": "+m.find(".weibo_text_drop").text());h=h.substr(0,h.lastIndexOf("//@"));var j=(280-h.len())/2;$(".publish-tweet").val(h);if(j<0){var i=$(".publish-tweet");var n=i.val().length+j;i.attr("maxlength",n);var l=i.val().substr(0,n);i.val(l);j=0}$("#weibo_dialog .word_counter").text(Math.floor(j))}}else{$("#pub_text").removeClass().addClass("sina");$("#pub_text").text("评论");$("#publish_title").text("评论微博")}}else{if(!$(".boxes #weibo_dialog").hasClass("disable")){$("#pub_wrapper, .pub_imply_tencent").hide();$(".pub_imply_sina").show();if($(this).hasClass("repost_f")){$("#publish_title").text("转发微博")}else{$("#publish_title").text("评论微博")}}}}else{if($(this).hasClass("tencent")){$(".boxes #weibo_dialog #icon_flag").removeClass().addClass("tencent16_icon");if($(".boxes #weibo_dialog").hasClass("tencent")){$("#pub_wrapper").show();$(".pub_imply_sina, .pub_imply_tencent").hide();if($(this).hasClass("repost_f")){$("#pub_text").text("转播").removeClass().addClass("tencent");$("#publish_title").text("转播微博");if($(this).hasClass("is_repost")){var m=$(this).closest("li");var h=("||"+m.find(".weibo_from_drop").text()+"(@"+m.find(".weibo_from_drop").attr("href").replace(/http:\/\/t.qq.com\//,"")+"): "+m.find(".weibo_text_drop").text());var r=h.match(/\|\|.*?\(@.*?\):[^|]+/g);h=h.replace(r[r.length-1],"");var j=(280-h.len())/2;$(".publish-tweet").val(h);if(j<0){var i=$(".publish-tweet");var n=i.val().length+j;i.attr("maxlength",n);var l=i.val().substr(0,n);i.val(l);j=0}$("#weibo_dialog .word_counter").text(Math.floor(j))}}else{$("#pub_text").removeClass().addClass("tencent");$("#pub_text").text("评论");$("#publish_title").text("评论微博")}}else{if(!$(".boxes #weibo_dialog").hasClass("disable")){$("#pub_wrapper, .pub_imply_sina").hide();$(".pub_imply_tencent").show();if($(this).hasClass("repost_f")){$("#publish_title").text("转播微博")}else{$("#publish_title").text("评论微博")}}}}}var q="txt_"+$(this).closest("li").attr("id");$(".publish-tweet").attr("id",q);var c=$(this).attr("href");var b=$(document).height(),p=$(window).width(),g=$(window).height(),o=$(window).width();$("#mask").css({width:p,height:b});$("#mask").show().css("opacity","0.7");var d=$(document).scrollTop(),f=$(document).scrollLeft();$(c).css("top",g/2-$(c).height()/2+d-100);$(c).css("left",o/2-$(c).width()/2+f);$(c).show()});$(".window .close").click(function(b){b.preventDefault();$("#mask").hide();$(".window").hide()});$("#mask").click(function(){$(this).hide();$(".window").hide()});$("#embed_a").toggle(function(b){b.preventDefault();$("#embed_bar").slideDown("slow");$(".arrow_up").css("display","inline-block");$(".arrow_down").hide();$("#embed_bar span .sto_embed").select()},function(b){b.preventDefault();$("#embed_bar").slideUp("slow");$(".arrow_down").show();$(".arrow_up").hide();$("#embed_bar span .sto_embed").select()});$(".sto_embed").click(function(){$(this).select()});$("#user_action").css("display","inline");$(".delete").click(function(g){g.preventDefault();var d=confirm("确定删除这个故事吗?");if(d==true){var f=$(this).attr("id").split("_"),c=f[1],h=f[2],b={uid:c,pid:h};$.post("/member/removestory.php",b,function(j,k){if(k=="success"){var i=$("#delete_"+c+"_"+h);if(i.hasClass("redirect")){self.location="/user/"+j}else{var e=i.closest("li");e.hide("slow",function(){e.remove()})}}})}});$(".act_digg").click(function(d){d.preventDefault();var f=$(this).attr("id").split("_"),c=f[2],b={post_id:c};$.get("/member/diggoperation.php",b,function(g,i){if(i=="success"){if(g==0){alert("您已经投票过了")}else{var e=$("#digg_count_"+c).text();var h=1+parseInt(e);$("#digg_count_"+c).text(h).attr("title","累计赞"+h+"次")}}})});$(".published-steps .tabs").click(function(b){var c=(b.target)?$(b.target):$(b.srcElement);c=c.closest("button");if(c.is(".tabs .post-tab")){$(".steps .notify-content").css("display","none");$(".steps .share-content").css("display","none");$(".steps .post-content").toggle();$(".post-content .sto_embed").select()}else{if(c.is(".tabs .notify-tab")){$(".steps .post-content").css("display","none");$(".steps .share-content").css("display","none");$(".steps .notify-content").toggle();$(".tabs .notify-tab").blur()}else{if(c.is(".tabs .share-tab")){$(".steps .post-content").css("display","none");$(".steps .notify-content").css("display","none");$(".steps .share-content").toggle();$(".tabs .share-tab").blur()}}}});$(".notify-tweet").live("keyup",function(h){var g=0,f=0;$(".sina_user .notify-user input").each(function(){if($(this).attr("checked")){g+=$(this).next().text().len()+1}});$(".tencent_user .notify-user input").each(function(){if($(this).attr("checked")){f+=$(this).next().attr("id").len()+2}});var d=(g>f)?g:f;var b=(280-$(this).val().len()-d)/2;if(b==0){var i=$(this).val().length;$(this).attr("maxlength",i)}if(b<0){var i=$(this).val().length+b;$(this).attr("maxlength",i);var c=$(this).val().substr(0,i);$(this).val(c);b=0}$(".tweet_control .word_counter").text(Math.floor(b))});$(".publish-tweet").live("keyup",function(d){var b=(280-$(this).val().len())/2;if(b==0){var f=$(this).val().length;$(this).attr("maxlength",f)}if(b<0){var f=$(this).val().length+b;$(this).attr("maxlength",f);var c=$(this).val().substr(0,f);$(this).val(c);b=0}$("#weibo_dialog .word_counter").text(Math.floor(b))});$(".btn_w_publish").live("click",function(i){var f,k,g=$(".publish-tweet"),b=$("#pub_text"),j=b.hasClass("sina"),d=g.val(),l=g.attr("id").substr(6);if(b.text()=="评论"){f="comment";k="评论成功"}else{f="repost";k="转发成功";if(!j){k="转播成功"}}var h,c;if(j){h="/weibo/postweibo.php"}else{h="/tweibo/posttweibo.php"}c={operation:f,id:l,weibo_content:d};$.ajax({type:"POST",url:h,data:c,success:function(e){$("#mask").hide();$(".window").hide();alert(k)}})});$(".tweet_btn").live("click",function(f){f.preventDefault();var c="",d="";$(".sina_user .notify-user input").each(function(){if($(this).attr("checked")){c+=$(this).next().text()+" "}});$(".tencent_user .notify-user input").each(function(){if($(this).attr("checked")){d+="@"+$(this).next().attr("id")+" "}});if(($("#tweibo_f").attr("checked"))&&(d!="")){d+=$(".notify-tweet").val();var g,b;g="/tweibo/posttweibo.php";b={operation:"publish",weibo_content:d};$.ajax({type:"POST",url:g,data:b,success:function(e){$(".steps .notify-content").css("display","none");alert("发布成功")}})}if(($("#weibo_f").attr("checked"))&&(c!="")){c+=$(".notify-tweet").val();var g,b;g="/weibo/postweibo.php";b={operation:"publish",weibo_content:c};$.ajax({type:"POST",url:g,data:b,success:function(e){$(".steps .notify-content").css("display","none");alert("发布成功")}})}if($(".steps .notify-content").is(":visible")){$(".steps .notify-content").css("display","none")}});$(".add_like").live("click",function(f){f.preventDefault();var d=$(this);if(d.hasClass("guest")){show_login()}else{var i=d.attr("id").split("_"),c=i[1],h=i[2],g="/member/likeoperation.php",b={operation:"add_like",uid:c,pid:h};$.post(g,b,function(e,j){if(j=="success"){$(".add_like span").text("取消喜欢");d.removeClass("add_like").addClass("del_like")}})}});$(".del_like").live("click",function(f){f.preventDefault();var d=$(this),i=d.attr("id").split("_"),c=i[1],h=i[2],g="/member/likeoperation.php",b={operation:"del_like",uid:c,pid:h};$.post(g,b,function(j,k){if(k=="success"){if(d.hasClass("remove_item")){var e=d.closest("li");e.hide("slow",function(){e.remove()})}else{$(".del_like span").text("喜欢");d.removeClass("del_like").addClass("add_like")}}})});$(".del_wrapper a").hover(function(){$(this).find("span").text("取消喜欢")},function(){$(this).find("span").text("喜欢")});$("#reply_input").val("我想说...").addClass("imply_color");$("#reply_input").blur(function(){if($(this).val()==""){$(this).val("我想说...").addClass("imply_color")}}).focus(function(){if($(this).val()=="我想说..."&&$(this).hasClass("imply_color")){$(this).val("").removeClass("imply_color")}});$(".reply_comment").live("click",function(c){c.preventDefault();var b="回复"+$(this).closest("li").find(".comment_author a").text()+": ";$("#reply_input").val(b).removeClass("imply_color").focus()});$(".post_comment").click(function(d){d.preventDefault();var c=$(d.target);if(c.hasClass("need_login")){show_login()}else{var b=$("#reply_input");temp_array=$(this).attr("id").split("_"),user_id_val=temp_array[2],post_id_val=temp_array[1],content_val=b.val();postData={post_id:post_id_val,user_id:user_id_val,comment_content:content_val};if(content_val==""||(content_val=="我想说..."&&b.hasClass("imply_color"))){return false}$.post("/member/postcomment.php",postData,function(e,f){if(f=="success"){$("#reply_input").val("我想说...").addClass("imply_color");$("#comment_list").prepend(e);$("#comment_list li:first").show("slow")}})}});$("#reply_container .load_more").live("click",function(g){g.preventDefault();var d=$("<img src='/img/loading.gif' />"),h=$(this).attr("id").split("_"),f=h[2],c=h[3],b={post_id:f,first:c};$.ajax({type:"POST",url:"/member/showcomments.php",data:b,beforeSend:function(){$("#reply_container .load_more").html(d)},success:function(e){$("#reply_container .load_more").closest("li").remove();$("#comment_list").append(e)}})});$(".del_comment").live("click",function(i){i.preventDefault();var g=confirm("确定删除这条评论吗?");if(g==true){var b=$(this).closest("li"),h=b.attr("id").split("_"),d=h[1],f=h[2],c={uid:d,cid:f};$.post("/member/deletecomment.php",c,function(e,j){if(j=="success"){b.hide("slow",function(){b.remove()})}})}});$("#userstory_container .load_more").live("click",function(j){j.preventDefault();var g,c,f,b,d=$(this).attr("id"),i=d.split("_"),h=i[1];c=i[2];if($(".sort_type .now").text()=="喜欢"){f="like"}else{f=""}b={from:"user",first_item:h,category:f,uid:c};imgloading=$("<img src='/img/loading.gif' />");$.ajax({type:"POST",url:"/member/loadmorestory.php",data:b,beforeSend:function(){$("#userstory_container .load_more").html(imgloading)},success:function(e){$(".more_content").remove();$(".sto_cover_list").append(e).after($(".more_content").remove())}})});$("#connectBtn").live("click",function(b){b.preventDefault();$.post("/accounts/login/sina_auth.php",{},function(c,d){$("#dialog.window").hide();self.location=c})});$("#comment_tab dd a").mouseover(function(c){var b=$(c.target);if(b.is("#kou_comment_tab")){b.addClass("active");$("#uyan_comment_tab").removeClass();$("#uyan_comment").css("display","none");$("#kou_comment").css("display","block")}else{if(b.is("#uyan_comment_tab")){b.addClass("active");$("#kou_comment_tab").removeClass();$("#kou_comment").css("display","none");$("#uyan_comment").css("display","block")}}})});