Array.prototype.getUnique=function(){var f={},c,d;for(c=0;d=this[c];c++){f[d]=1}var b=new Array();for(d in f){b.push(d)}return b};String.prototype.len=function(){return this.replace(/[^\x00-\xff]/g,"**").length};$(function(){$("body").prepend("<div id='mask'></div>");$(".follow").click(function(){var a=$(this).attr("id"),e=a.split("_"),c=e[2],f=$(this).text();if("关注"==f){f="follow"}else{f="unfollow"}var d={operation:f,uid:c},b="";$.post("/member/useroperation.php",d,function(g,h){if("success"==h){if(f=="follow"){b=$(".account_count .fans_count").text();$(".account_count .fans_count").text(parseInt(b)+1)}else{b=$(".account_count .fans_count").text();$(".account_count .fans_count").text(parseInt(b)-1)}$(".follow").toggle()}})}).hover(function(){if($(this).text()=="已关注"){$(this).text("取消关注")}},function(){if($(this).text()=="取消关注"){$(this).text("已关注")}});$(".follow_btn").click(function(){var a=$(this).attr("id"),e=a.split("_"),c=e[2],f=$(this).text();if("关注"==f){f="follow"}else{f="unfollow"}var d={operation:f,uid:c},b="";$.post("/member/useroperation.php",d,function(h,i){if("success"==i){if(f=="follow"){b=$(".usersfollowers .count").text();$(".usersfollowers .count").text(parseInt(b)+1);$(".follower_list").append(h)}else{var g=e[0];$("#follower_id_"+g).remove();b=$(".usersfollowers .count").text();$(".usersfollowers .count").text(parseInt(b)-1)}$(".follow_btn").toggle()}console.log(h)})}).hover(function(){if($(this).text()=="已关注"){$(this).text("取消关注")}},function(){if($(this).text()=="取消关注"){$(this).text("已关注")}});$("#publish_container .load_more").live("click",function(b){b.preventDefault();var j="",g=$(this).attr("id"),i=g.split("_"),d=i[2],c=i[0],h=c-1,f={post_id:d,first_item:c},a=$("<img src='/img/loading.gif' />");$.ajax({type:"POST",url:"/member/loadstoryitem.php",data:f,beforeSend:function(){$("#publish_container .load_more").html(a)},success:function(e){$("#more").remove();$("#weibo_ul").append(e);$("#weibo_ul li:gt("+h+")").each(function(){if($(this).hasClass("sina")){j=$(this).attr("id");WB2.anyWhere(function(k){k.widget.hoverCard({id:j,search:true})})}})}})});WB2.anyWhere(function(a){a.widget.hoverCard({id:"weibo_card_area",search:true})});$("#weibo_ul li.sina").each(function(){var a=$(this).attr("id");WB2.anyWhere(function(b){b.widget.hoverCard({id:a,search:true})})});$("a[name=modal]").live("click",function(j){j.preventDefault();$(".publish-tweet").val("");$("#weibo_dialog .word_counter").text("140");if($(this).hasClass("sina")){$("#boxes #weibo_dialog #icon_flag").removeClass().addClass("sina16_icon");if($("#boxes #weibo_dialog").hasClass("sina")){$("#pub_wrapper").show();$(".pub_imply_sina, .pub_imply_tencent").hide();if($(this).hasClass("repost_f")){$("#pub_text").text("转发").removeClass().addClass("sina");$("#publish_title").text("转发微博");if($(this).hasClass("is_repost")){var l=$(this).closest("li");var g=("//@"+l.find(".weibo_from_drop").text()+": "+l.find(".weibo_text_drop").text());g=g.substr(0,g.lastIndexOf("//@"));var i=(280-g.len())/2;$(".publish-tweet").val(g);if(i<0){var h=$(".publish-tweet");var m=h.val().length+i;h.attr("maxlength",m);var k=h.val().substr(0,m);h.val(k);i=0}$("#weibo_dialog .word_counter").text(Math.floor(i))}}else{$("#pub_text").removeClass().addClass("sina");$("#pub_text").text("评论");$("#publish_title").text("评论微博")}}else{if(!$("#boxes #weibo_dialog").hasClass("disable")){$("#pub_wrapper, .pub_imply_tencent").hide();$(".pub_imply_sina").show();if($(this).hasClass("repost_f")){$("#publish_title").text("转发微博")}else{$("#publish_title").text("评论微博")}}}}else{if($(this).hasClass("tencent")){$("#boxes #weibo_dialog #icon_flag").removeClass().addClass("tencent16_icon");if($("#boxes #weibo_dialog").hasClass("tencent")){$("#pub_wrapper").show();$(".pub_imply_sina, .pub_imply_tencent").hide();if($(this).hasClass("repost_f")){$("#pub_text").text("转播").removeClass().addClass("tencent");$("#publish_title").text("转播微博");if($(this).hasClass("is_repost")){var l=$(this).closest("li");var g=("||"+l.find(".weibo_from_drop").text()+"(@"+l.find(".weibo_from_drop").attr("href").replace(/http:\/\/t.qq.com\//,"")+"): "+l.find(".weibo_text_drop").text());var q=g.match(/\|\|.*?\(@.*?\):[^|]+/g);g=g.replace(q[q.length-1],"");var i=(280-g.len())/2;$(".publish-tweet").val(g);if(i<0){var h=$(".publish-tweet");var m=h.val().length+i;h.attr("maxlength",m);var k=h.val().substr(0,m);h.val(k);i=0}$("#weibo_dialog .word_counter").text(Math.floor(i))}}else{$("#pub_text").removeClass().addClass("tencent");$("#pub_text").text("评论");$("#publish_title").text("评论微博")}}else{if(!$("#boxes #weibo_dialog").hasClass("disable")){$("#pub_wrapper, .pub_imply_sina").hide();$(".pub_imply_tencent").show();if($(this).hasClass("repost_f")){$("#publish_title").text("转播微博")}else{$("#publish_title").text("评论微博")}}}}}var p="txt_"+$(this).closest("li").attr("id");$(".publish-tweet").attr("id",p);var b=$(this).attr("href");var a=$(document).height(),o=$(window).width(),f=$(window).height(),n=$(window).width();$("#mask").css({width:o,height:a});$("#mask").show().css("opacity","0.7");var c=$(document).scrollTop(),d=$(document).scrollLeft();$(b).css("top",f/2-$(b).height()/2+c-100);$(b).css("left",n/2-$(b).width()/2+d);$(b).show()});$(".window .close").click(function(a){a.preventDefault();$("#mask").hide();$(".window").hide()});$("#mask").click(function(){$(this).hide();$(".window").hide()});$("#embed_a").toggle(function(a){a.preventDefault();$("#embed_bar").slideDown("slow");$(".arrow_up").css("display","inline-block");$(".arrow_down").hide();$("#embed_bar span .sto_embed").select()},function(a){a.preventDefault();$("#embed_bar").slideUp("slow");$(".arrow_down").show();$(".arrow_up").hide();$("#embed_bar span .sto_embed").select()});$(".sto_embed").click(function(){$(this).select()});$("#user_action").css("display","inline");$(".delete").click(function(d){d.preventDefault();var c=confirm("确定删除这个故事吗?");if(c==true){var b=$(this).attr("id").replace(/_delete/,""),a={post_id:b};$.get("/member/removestory.php",a,function(f,g){if(g=="success"){if($("#"+b+"_delete").hasClass("redirect")){self.location="/user/"+f}else{var e=$("#"+b+"_delete").closest("li");e.hide("slow",function(){e.remove()})}}})}});$(".act_digg").click(function(c){c.preventDefault();var d=$(this).attr("id").split("_");var b=d[2];var a={post_id:b};$.get("/member/diggoperation.php",a,function(f,h){if(h=="success"){if(f==0){alert("您已经投票过了")}else{var e=$("#digg_count_"+b).text();var g=1+parseInt(e);$("#digg_count_"+b).text(g).attr("title","累计赞"+g+"次")}}})});$(".published-steps .tabs").click(function(a){var b=(a.target)?$(a.target):$(a.srcElement);b=b.closest("button");if(b.is(".tabs .post-tab")){$(".steps .notify-content").css("display","none");$(".steps .share-content").css("display","none");$(".steps .post-content").toggle();$(".post-content .sto_embed").select()}else{if(b.is(".tabs .notify-tab")){$(".steps .post-content").css("display","none");$(".steps .share-content").css("display","none");$(".steps .notify-content").toggle();$(".tabs .notify-tab").blur()}else{if(b.is(".tabs .share-tab")){$(".steps .post-content").css("display","none");$(".steps .notify-content").css("display","none");$(".steps .share-content").toggle();$(".tabs .share-tab").blur()}}}});$(".notify-tweet").live("keyup",function(g){var f=0,d=0;$(".sina_user .notify-user input").each(function(){if($(this).attr("checked")){f+=$(this).next().text().len()+1}});$(".tencent_user .notify-user input").each(function(){if($(this).attr("checked")){d+=$(this).next().attr("id").len()+2}});var c=(f>d)?f:d;var a=(280-$(this).val().len()-c)/2;if(a==0){var h=$(this).val().length;$(this).attr("maxlength",h)}if(a<0){var h=$(this).val().length+a;$(this).attr("maxlength",h);var b=$(this).val().substr(0,h);$(this).val(b);a=0}$(".tweet_control .word_counter").text(Math.floor(a))});$(".publish-tweet").live("keyup",function(c){var a=(280-$(this).val().len())/2;if(a==0){var d=$(this).val().length;$(this).attr("maxlength",d)}if(a<0){var d=$(this).val().length+a;$(this).attr("maxlength",d);var b=$(this).val().substr(0,d);$(this).val(b);a=0}$("#weibo_dialog .word_counter").text(Math.floor(a))});$(".btn_w_publish").live("click",function(f){var c=$(".publish-tweet").val();var b=$(".publish-tweet").attr("id").substr(6);var d;if($("#pub_text").text()=="评论"){d="comment"}else{d="repost"}var g,a;if($("#pub_text").hasClass("sina")){g="/weibo/postweibo.php"}else{g="/tweibo/posttweibo.php"}a={operation:d,id:b,weibo_content:c};$.ajax({type:"POST",url:g,data:a,success:function(e){$("#mask").hide();$(".window").hide()}})});$(".tweet_btn").live("click",function(d){d.preventDefault();var b="",c="";$(".sina_user .notify-user input").each(function(){if($(this).attr("checked")){b+=$(this).next().text()+" "}});$(".tencent_user .notify-user input").each(function(){if($(this).attr("checked")){c+="@"+$(this).next().attr("id")+" "}});if(($("#tweibo_f").attr("checked"))&&(c!="")){c+=$(".notify-tweet").val();var f,a;f="/tweibo/posttweibo.php";a={operation:"publish",weibo_content:c};$.ajax({type:"POST",url:f,data:a,success:function(e){$(".steps .notify-content").css("display","none")}})}if(($("#weibo_f").attr("checked"))&&(b!="")){b+=$(".notify-tweet").val();var f,a;f="/weibo/postweibo.php";a={operation:"publish",weibo_content:b};$.ajax({type:"POST",url:f,data:a,success:function(e){$(".steps .notify-content").css("display","none")}})}if($(".steps .notify-content").is(":visible")){$(".steps .notify-content").css("display","none")}});$("#reply_input").val("我想说...").addClass("imply_color");$("#reply_input").blur(function(){if($(this).val()==""){$(this).val("我想说...").addClass("imply_color")}}).focus(function(){if($(this).val()=="我想说..."&&$(this).hasClass("imply_color")){$(this).val("").removeClass("imply_color")}});$(".reply_comment").live("click",function(b){b.preventDefault();var a="回复"+$(this).closest("li").find(".comment_author a").text()+": ";$("#reply_input").val(a).removeClass("imply_color").focus()});$(".post_comment").click(function(b){b.preventDefault();var a=$("#reply_input");temp_array=$(this).attr("id").split("_"),user_id_val=temp_array[2],post_id_val=temp_array[1],content_val=a.val();getData={post_id:post_id_val,user_id:user_id_val,comment_content:content_val};if(content_val==""||(content_val=="我想说..."&&a.hasClass("imply_color"))){return false}$.get("/member/postcomment.php",getData,function(c,d){if(d=="success"){$("#reply_input").val("我想说...").addClass("imply_color");$("#comment_list").prepend(c);$("#comment_list li:first").show("slow")}})});$("#reply_container .load_more").live("click",function(f){f.preventDefault();var c=$("<img src='/img/loading.gif' />"),g=$(this).attr("id").split("_"),d=g[2],b=g[3],a={post_id:d,first:b};$.ajax({type:"GET",url:"/member/showcomments.php",data:a,beforeSend:function(){$("#reply_container .load_more").html(c)},success:function(e){$("#reply_container .load_more").closest("li").remove();$("#comment_list").append(e)}})});$(".del_comment").live("click",function(c){c.preventDefault();var b=confirm("确定删除这条评论吗?");if(b==true){var a=$(this).closest("li");comment_id_val=a.attr("id").substr(8);getData={comment_id:comment_id_val};$.get("/member/deletecomment.php",getData,function(d,e){if(e=="success"){a.hide("slow",function(){a.remove()})}})}})});