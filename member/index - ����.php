<?phpinclude "../global.php";?><link type="text/css" href="/storify/css/jquery.ui.theme.css" rel="stylesheet" /><link type="text/css" href="/storify/css/jquery.ui.tabs.css" rel="stylesheet" /><link type="text/css" rel="stylesheet" href="http://js.wcdn.cn/t3/style/css/common/card.css" /><script type='text/javascript' src='http://js.wcdn.cn/t3/platform/js/api/wb.js'></script><script type='text/javascript' src='/storify/js/weibo.js'></script><script type='text/javascript' src='/storify/js/jquery-ui-1.8.12.custom.min.js'></script><script>function display_search(){  $('.weibo_drag').remove();  $('#keywords').val('');  $('#weibo_search button').text('搜索微博');  $('#weibo_search').css('display', 'block');}function display_user_search(){  $('.weibo_drag').remove();  $('#keywords').val('');  $('#weibo_search button').text('搜索用户');  $('#weibo_search').css('display', 'block');}function get_weibo_by_id(id_array){  var weiboText, from, from_id, created_time, photo;  var div_content = new Array();  var j=0;  for (var i in id_array)  {	//debugger;	//var $content = $("<li class='weibo_drop' id='"+id_array[i]+"'></li>");	//$('#story_list').append($content);	WB.client.parseCMD('/statuses/show/#{id}.json', function(sResult, bStatus)    {	  weiboText= sResult.text;	  created_time = sResult.created_at;	  created_time = date_format(created_time);  	  from = sResult.user.screen_name;	  from_id = sResult.user.id;	  photo = sResult.user.profile_image_url;	  //div_content.push("<div class='cross' action='delete' style='visibility:hidden; padding-left:355px;'><a><img src='/Storify/img/cross.png' border='0' onclick='remove_item(event)'/></a></div><div class='story_wrapper'><div><span class='weibo_text_drop'>"+weiboText+"</span></div><div id='story_signature'><div style='float:right;'><a href='http://weibo.com/"+from_id+"' target='_blank'><img class='profile_img_drop' style='width: 32px; height: 32px; overflow: hidden; margin-top:2px;' src='"+photo+"' alt='"+from+"' border=0 /></a></div><div id='signature_text' style='float:right; margin-right:5px;'><a class='weibo_from_drop' href='http://weibo.com/"+from_id+"' target='_blank' style='display:block; height:16px;'><span>"+from+"</span></a><span class='weibo_date_drop' style='display:block; height:16px;'>"+created_time+"</span></div></div></div>");	  var $div_content = $("<li class='weibo_drop' id='"+id_array[j]+"'><div class='cross' action='delete' style='visibility:hidden; padding-left:355px;'><a><img src='/Storify/img/cross.png' border='0' onclick='remove_item(event)'/></a></div><div class='story_wrapper'><div><span class='weibo_text_drop'>"+weiboText+"</span></div><div id='story_signature'><div style='float:right;'><a href='http://weibo.com/"+from_id+"' target='_blank'><img class='profile_img_drop' style='width: 32px; height: 32px; overflow: hidden; margin-top:2px;' src='"+photo+"' alt='"+from+"' border=0 /></a></div><div id='signature_text' style='float:right; margin-right:5px;'><a class='weibo_from_drop' href='http://weibo.com/"+from_id+"' target='_blank' style='display:block; height:16px;'><span>"+from+"</span></a><span class='weibo_date_drop' style='display:block; height:16px;'>"+created_time+"</span></div></div></div></li>");	  $('#story_list').append($div_content);	  j++;	},	{	  id : id_array[i]	},	{	  method: 'get'	});  }  //setTimeout("append_content(id_array, div_content)", 1000);  //append_content(id_array, div_content);  /*for (var i in id_array)  {	var $contentToAppend = $(div_content[i]);	$("#" + id_array[i]).append($contentToAppend);  }*/}function append_content(id_array, content_array){  for (var i in id_array)  {	//debugger;	var $contentToAppend = $(content_array[i]);	$("#" + id_array[i]).append($contentToAppend);  }}function get_weibo_by_id4(id_array){  for (var i=0;i<id_array.length;i++)   {    WB.client.parseCMD('/statuses/show/#{id}.json', function(sResult, bStatus)    {	  var weiboText, from, from_id, created_time, photo;	  weiboText= sResult.text;	  created_time = sResult.created_at;	  created_time = date_format(created_time);  	  from = sResult.user.screen_name;	  from_id = sResult.user.id;	  photo = sResult.user.profile_image_url;	  var content = ("<li class='weibo_drop'><div class='cross' action='delete' style='visibility:hidden; padding-left:355px;'><a><img src='/Storify/img/cross.png' border='0' onclick='remove_item(event)'/></a></div><div class='story_wrapper'><div><span class='weibo_text_drop' id='"+id_array[i]+"'>"+weiboText+"</span></div><div id='story_signature'><div style='float:right;'><a href='http://weibo.com/"+from_id+"' target='_blank'><img class='profile_img_drop' style='width: 32px; height: 32px; overflow: hidden; margin-top:2px;' src='"+photo+"' alt='"+from+"' border=0 /></a></div><div id='signature_text' style='float:right; margin-right:5px;'><a class='weibo_from_drop' href='http://weibo.com/"+from_id+"' target='_blank' style='display:block; height:16px;'><span>"+from+"</span></a><span class='weibo_date_drop' style='display:block; height:16px;'>"+created_time+"</span></div></div></div></li>");	  $('#story_list').append(content);	},	{	  id : id_array[i]	},	{	  method: 'get'	});  }}$(function() {		$( '#tabs' ).tabs();				if($('#sto_title').val() =='')		{		  $('#sto_title').val('写下你的故事标题吧(这将会是你故事的链接地址)').css('color', 'black').focus(function(){		  $(this).val('').css('color', 'black');		  }).blur(function(){		  if($(this).val() == '')		  {		    $(this).val('写下你的故事标题吧(这将会是你故事的链接地址)').css('color', 'black');		  }		  });		}						if($('#sto_summary').val() =='')		{		  $('#sto_summary').val('给你的故事写一个简短的描述').css('color', '#d8d8d8').focus(function(){		  $(this).val('').css('color', 'black');		  }).blur(function(){		  if($(this).val() == '')		  {		    $(this).val('给你的故事写一个简短的描述').css('color', '#d8d8d8');		  }		  });		}						$('#story_list').hover(function(e){		if ($(e.target).is('.weibo_drop'))		{		  //$('.cross').css('visibility', 'hidden');		  $(e.target).children('.cross').css('visibility', 'visible');		}		},		function(ev)		{		  if ($(ev.target).is('.weibo_drop'))		  {		    //$('.cross').css('visibility', 'hidden');			$(ev.target).children('.cross').css('visibility', 'hidden');		  }		});						/*$('#story_list').mouseover(function(e)		{		  if ($(e.target).is('li'))		  {		    $(e.target).find('.cross').css('visibility', 'visible');		  }		});				$('#story_list').mouseout(function(e)		{		  if ($(e.target).is('li'))		  {		    $(e.target).find('.cross').css('visibility', 'hidden');		  }		});*/						$('#draftBtn').click(function(e){		  //debugger;		  e.preventDefault();		  console.log('begin draft');		  var story_id_val;		  if (typeof(post_id)=="undefined" || post_id==null)		  {		    story_id_val = 0;		  }		  else		  {		    story_id_val = post_id;		  }		  var weibo_id_val = new Array();		  $('.weibo_drop').each(		  function(i)		  {			weibo_id_val[i] = $(this).attr('id');		  });		  var story_title_val = $('#sto_title').attr('value');		  var story_summary_val = $('#sto_summary').val();		  var postdata = {story_id: story_id_val, story_title: story_title_val, story_summary: story_summary_val, weibo_id: weibo_id_val};			  		  $.post('preview.php', postdata,		  function(data, textStatus)		  {            console.log(data);									self.location = data;		  });					});				$('#previewBtn').click(function(e){			//debugger;		  e.preventDefault();		  console.log('begin preview');		  var story_id_val;		  if (typeof(post_id)=="undefined" || post_id==null)		  {		    story_id_val = 0;		  }		  else		  {		    story_id_val = post_id;		  }		  var weibo_id_val = new Array();		  $('.weibo_drop').each(		  function(i)		  {			weibo_id_val[i] = $(this).attr('id');		  });		  var story_title_val = $('#sto_title').attr('value');		  var story_summary_val = $('#sto_summary').val();		  var postdata = {story_id: story_id_val, story_title: story_title_val, story_summary: story_summary_val, weibo_id: weibo_id_val};		  $.post('preview.php', postdata,		  function(data, textStatus)		  {            console.log(data);									self.location = data;		  });					});				$('#publishBtn').click(function(e)		{		  //debugger;		  e.preventDefault();		  //console.log(post_id);		  console.log('begin publish');		  var story_id_val;		  if (typeof(post_id)=="undefined" || post_id==null)		  {		    story_id_val = 0;		  }		  else		  {		    story_id_val = post_id;		  }		  var weibo_id_val = new Array();		  $('.weibo_drop').each(		  function(i)		  {			weibo_id_val[i] = $(this).attr('id');		  });		  var story_title_val = $('#sto_title').attr('value');		  var story_summary_val = $('#sto_summary').val();		  //var postdata = {story_id: story_id_val, story_title: story_title_val, story_summary: story_summary_val, weibo_id: weibo_id_val, weibo_author: weibo_author_val, weibo_content: weibo_content_val, weibo_date: weibo_date_val, weibo_photo: weibo_photo_val, weibo_from_id: weibo_from_id_val};		  //var postdata = {weibo_author: $('.profile_img_drop').attr('alt'), weibo_content: $('.weibo_text_drop').text(), weibo_date: $('.weibo_date_drop').text(), weibo_photo: $('.profile_img_drop').attr('src'), weibo_from_id: $('.profile_img_drop').attr('alt')};				  var postdata = {story_id: story_id_val, story_title: story_title_val, story_summary: story_summary_val, weibo_id: weibo_id_val};		  $.post('publish.php', postdata,		  function(data, textStatus)		  {            console.log(data);									self.location = data;					  });		});	  	});</script><?php$content = "<div class='div_center'><div id='actions' style='margin-left:20px;'><span><a id='draftBtn' href='./' >保存草稿</a></span><span style='margin-left:30px;'><a id='previewBtn' href='./' >预览</a></span><span style='margin-left:30px;'><a id='publishBtn' href='./' >发布</a></span></div><div class='content'>  <div class='inner'>	<div id='source_pane' class='float_l showborder'>	  <div id='source_controller'>	  </div>	  <div id='sourcelist_container'>	    <div id='tabs'>		  <ul>		    <!--<li><a href='#tabs-1' onclick='run_api_cmd2()'>微博搜索</a></li>-->			<li><a href='#tabs-1' onclick='display_search()'>微博搜索</a></li>		    <li><a href='#tabs-2' onclick='my_weibo()'>我的微博</a></li>		    <li><a href='#tabs-3' onclick='my_follow()'>我的关注</a></li>		    <li><a href='#tabs-4' onclick='display_user_search()'>用户搜索</a></li>	      </ul>		<div id='tabs-1'> 		  	    </div> 	    <div id='tabs-2'> 		  	    </div> 	    <div id='tabs-3'> 		  	    </div> 	    <div id='tabs-4'> 		 	    </div> 				<div id='weibo_search' style='padding-left:10px;'>		  <form id='source_controller_form' action='#'>		    <p class='sep'>			  <label for='keywords'>关键字:</label><br />           			  <input style='width: 300px;' id='keywords' name='keywords' type='text'>			  <button type='button' value='search' onclick='weibo_search()'>搜索微博</button>            </p>			<p></p>		  </form>		</div>	    	    		<ul id='source_list' style='padding:0;'>		</ul>		</div>	  </div>	</div>	<div id='story_pane' class='float_l showborder'>	  <div id='story'>";if(isset($_GET['post_id'])){    $post_id = $_GET['post_id'];  echo "<script language=javascript >  var post_id=$post_id;  </script>";  $result = $DB->fetch_one_array("select * from ".$db_prefix."posts where ID='".$post_id."'");  if(!$result)  {	throw new Exception('Could not execute query.');  }  $story_title=$result['post_title'];  $story_summary=$result['post_summary'];  //$story_status=$result['post_status'];  $content .="<div id='story_header'>		  <span > <input type='text' value='".$story_title."' name='story_title' id='sto_title' style='width:400px; margin:10px; font-weight:bold;'> </span>		  <div>		    <textarea id='sto_summary' style='width:400px; height:60px; margin:0px 10px;'>".$story_summary."</textarea>		  </div>		</div>		<div id='storylist_container'>		  <ul id='story_list' style='padding:0;'>		  </ul>		</div>	  </div>	</div>  </div></div></div>";  echo $content;    $result=$DB->query("SELECT * FROM ".$db_prefix."weibo where weibo_post_ID='".$post_id."'");  $weibo_id_array_php = array();  while ($weibo_item = mysql_fetch_array($result))   {	array_push($weibo_id_array_php, $weibo_item['weibo_permanent_ID']);  }  $weibo_id__array_json = json_encode($weibo_id_array_php);  echo "<script language='javascript' >			var weibo_id_array_js = $weibo_id__array_json;			window.onload = function()			{			  get_weibo_by_id(weibo_id_array_js);			}			</script>";}else{  $content .= "<div id='story_header'>		  <span > <input type='text' value='' name='story_title' id='sto_title' style='width:400px; margin:10px; font-weight:bold;'> </span>		  <div>		    <textarea id='sto_summary' style='width:400px; height:60px; margin:0px 10px;'></textarea>		  </div>		</div>		<div id='storylist_container'>		  <ul id='story_list' style='padding:0;'>		  </ul>		</div>	  </div>	</div>  </div></div></div>";  echo $content;}include "../include/footer.htm";?>